<!DOCTYPE html>
<html>

<head>
  <title>Brihadeeswarar Temple - Nandi Sculpture Label</title>
  <link rel="stylesheet" href="indexdup.css">

</head>

<body>
  <div id="vr-splash">
    <div class="splash-content">
      <h1>Experience TN Verse</h1>
      <p>Enter the immersive virtual tour of Brihadeeswarar Temple. Audio guide will start automatically.</p>
      <button id="start-vr-btn">Begin Virtual Tour</button>
    </div>
  </div>

  <div class="top-controls">
    <select id="language-switcher">
      <option value="en">English</option>
      <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
      <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
      <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
    </select>
    <button id="audio-control-btn">üîä Audio Enabled</button>
    <button id="fullscreen-btn">Fullscreen</button>
  </div>
  <div id="location-buttons">
    <button onclick="goTo('nandi')" id="btn-nandi">Nandi</button>
    <button onclick="goTo('dwarapalaka')" id="btn-dwarapalaka">Dwarapalaka</button>
    <button onclick="goTo('lingam')" id="btn-lingam">Lingam</button>
  </div>
  <div id="street-view"></div>
  <!-- Sculpture Labels -->
  <div class="custom-label" id="nandi-label">
    <span class="label-title">Nandi - Sacred Bull</span>
    <div class="label-desc">Monolithic sculpture, 16th century. Carved from a single stone and weighing 25 tons.</div>
  </div>
  <div class="custom-label" id="dwarapalaka-label">
    <span class="label-title">Dwarapalaka - Guardian Deity</span>
    <div class="label-desc">As you enter, you see the massive Dwarapalakas, the guardian deities signifying protection.
    </div>
  </div>
  <div class="custom-label" id="lingam-label">
    <span class="label-title">Shiva Lingam</span>
    <div class="label-desc">This is the main deity, the Shiva Lingam. It stands as a symbol of cosmic power.</div>
  </div>

  <!-- Audio elements with preload -->
  <!-- Audio elements with preload -->
  <audio id="nandi-audio" src="audio/nandhi.mp3" preload="auto"></audio>
  <audio id="dwarapalaka-audio" src="audio/dwarapalaka.mp3" preload="auto"></audio>
  <audio id="lingam-audio" src="audio/shiva_lingam.mp3" preload="auto"></audio>


  <script>
    let panorama = null;
    let panoramaReady = false;
    let audioContextLoaded = false;
    let currentActiveLocation = null;
    const audioBtn = document.getElementById('audio-control-btn');
    let audioState = 'paused';

    function updateAudioButton() {
      if (audioState === 'playing') {
        audioBtn.textContent = 'üîä Audio Enabled';
        audioBtn.style.background = '#ff8c00';
        audioBtn.style.color = 'white';
      } else if (audioState === 'paused') {
        audioBtn.textContent = 'üîá Audio Disabled';
        audioBtn.style.background = 'white';
        audioBtn.style.color = '#ff8c00';
      } else if (audioState === 'ended') {
        audioBtn.textContent = 'üîÅ Repeat Audio';
        audioBtn.style.background = '#ff8c00';
        audioBtn.style.color = 'white';
      }
    }

    function toggleAudio() {
      const audio = document.getElementById(`${currentActiveLocation}-audio`);
      if (!audio) return;

      if (audioState === 'playing') {
        audio.pause();
        audioState = 'paused';
      } else if (audioState === 'paused') {
        audio.play();
        audioState = 'playing';
      } else if (audioState === 'ended') {
        audio.currentTime = 0;
        audio.play();
        audioState = 'playing';
      }
      updateAudioButton();
    }

    audioBtn.addEventListener('click', toggleAudio);

    function playLocationAudio(locationId) {
      document.querySelectorAll('audio').forEach(a => {
        a.pause();
        a.currentTime = 0;
        a.onended = null;
      });

      const audio = document.getElementById(`${locationId}-audio`);
      if (audio) {
        audio.onended = () => {
          audioState = 'ended';
          updateAudioButton();
        };

        audio.play().then(() => {
          audioState = 'playing';
          updateAudioButton();
        }).catch(err => {
          console.warn("Autoplay blocked or audio error:", err);
          audioState = 'paused';
          updateAudioButton();
        });
      }
    }

    document.getElementById('start-vr-btn').addEventListener('click', () => {
      document.getElementById('vr-splash').style.opacity = '0';
      setTimeout(() => {
        document.getElementById('vr-splash').style.display = 'none';
      }, 800);

      currentActiveLocation = 'nandi';
      audioContextLoaded = true;
      playLocationAudio('nandi');
    });

    document.getElementById('language-switcher').addEventListener('change', function () {
      const lang = this.value;
      const translations = {
        nandi: {
          en: { title: 'Nandi - Sacred Bull', desc: 'Monolithic sculpture, 16th century. Carved from a single stone and weighing 25 tons.', nav: 'Nandi' },
          ta: { title: '‡Æ®‡Æ®‡Øç‡Æ§‡Æø ‡Æö‡Æø‡Æ≤‡Øà', desc: '‡Æí‡Æ∞‡Øá ‡Æï‡Æ≤‡Øç‡Æ≤‡Æø‡Æ≤‡Øç ‡Æö‡ØÜ‡Æ§‡ØÅ‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡ØÅ 25 ‡Æü‡Æ©‡Øç ‡Æé‡Æü‡Øà‡ÆØ‡ØÅ‡Æ≥‡Øç‡Æ≥ ‡Æ®‡Æ®‡Øç‡Æ§‡Æø, ‡Æï‡Æ∞‡ØÅ‡Æµ‡Æ±‡Øà‡ÆØ‡Øà ‡Æ®‡Øã‡Æï‡Øç‡Æï‡ØÅ‡Æï‡Æø‡Æ±‡Ææ‡Æ∞‡Øç.', nav: '‡Æ®‡Æ®‡Øç‡Æ§‡Æø' },
          kn: { title: '‡≤®‡≤Ç‡≤¶‡≤ø ‡≤µ‡≤ø‡≤ó‡≥ç‡≤∞‡≤π', desc: '‡≤í‡≤Ç‡≤¶‡≥á ‡≤ï‡≤≤‡≥ç‡≤≤‡≤ø‡≤®‡≤ø‡≤Ç‡≤¶ ‡≤ï‡≥Ü‡≤§‡≥ç‡≤§‡≤≤‡≥ç‡≤™‡≤ü‡≥ç‡≤ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å 25 ‡≤ü‡≤®‡≥ç ‡≤§‡≥Ç‡≤ï‡≤¶ ‡≤®‡≤Ç‡≤¶‡≤ø‡≤Ø‡≥Å ‡≤ó‡≤∞‡≥ç‡≤≠‡≤ó‡≥Å‡≤°‡≤ø‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≥ã‡≤°‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü.', nav: '‡≤®‡≤Ç‡≤¶‡≤ø' },
          hi: { title: '‡§®‡§Ç‡§¶‡•Ä', desc: '‡§è‡§ï ‡§π‡•Ä ‡§™‡§§‡•ç‡§•‡§∞ ‡§∏‡•á ‡§®‡§ï‡•ç‡§ï‡§æ‡§∂‡•Ä‡§¶‡§æ‡§∞ ‡§î‡§∞ 25 ‡§ü‡§® ‡§µ‡§ú‡§® ‡§ï‡§æ, ‡§®‡§Ç‡§¶‡•Ä ‡§ó‡§∞‡•ç‡§≠‡§ó‡•É‡§π ‡§ï‡•Ä ‡§ì‡§∞ ‡§¶‡•á‡§ñ‡§§‡§æ ‡§π‡•à‡•§', nav: '‡§®‡§Ç‡§¶‡•Ä' }
        },
        dwarapalaka: {
          en: { title: 'Dwarapalaka - Guardian Deity', desc: 'As you enter, you see the massive Dwarapalakas, the guardian deities signifying protection.', nav: 'Dwarapalaka' },
          ta: { title: '‡Æ§‡ØÅ‡Æµ‡Ææ‡Æ∞‡Æ™‡Ææ‡Æ≤‡Æï‡Æ∞‡Øç', desc: '‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡Øá ‡Æ®‡ØÅ‡Æ¥‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç‡Æ™‡Øã‡Æ§‡ØÅ, ‡Æ™‡Æø‡Æ∞‡ÆÆ‡Ææ‡Æ£‡Øç‡Æü‡ÆÆ‡Ææ‡Æ© ‡Æ§‡ØÅ‡Æµ‡Ææ‡Æ∞‡Æ™‡Ææ‡Æ≤‡Æï‡Æ∞‡Øç‡Æï‡Æ≥‡Øà‡Æï‡Øç ‡Æï‡Ææ‡Æ£‡Øç‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç. ‡ÆÖ‡Æµ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Ææ‡Æ§‡ØÅ‡Æï‡Ææ‡Æ™‡Øç‡Æ™‡Øà‡Æï‡Øç ‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Øç‡Æï‡Æø‡Æ±‡Ææ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç.', nav: '‡Æ§‡ØÅ‡Æµ‡Ææ‡Æ∞‡Æ™‡Ææ‡Æ≤‡Æï‡Æ∞‡Øç' },
          kn: { title: '‡≤¶‡≥ç‡≤µ‡≤æ‡≤∞‡≤™‡≤æ‡≤≤‡≤ï', desc: '‡≤®‡≥Ä‡≤µ‡≥Å ‡≤™‡≥ç‡≤∞‡≤µ‡≥á‡≤∂‡≤ø‡≤∏‡≤ø‡≤¶‡≤Ç‡≤§‡≥Ü, ‡≤∞‡≤ï‡≥ç‡≤∑‡≤ï ‡≤¶‡≥á‡≤µ‡≤§‡≥Ü‡≤ó‡≤≥‡≤æ‡≤¶ ‡≤¨‡≥É‡≤π‡≤§‡≥ç ‡≤¶‡≥ç‡≤µ‡≤æ‡≤∞‡≤™‡≤æ‡≤≤‡≤ï‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≥Ä‡≤µ‡≥Å ‡≤®‡≥ã‡≤°‡≥Å‡≤§‡≥ç‡≤§‡≥Ä‡≤∞‡≤ø.', nav: '‡≤¶‡≥ç‡≤µ‡≤æ‡≤∞‡≤™‡≤æ‡≤≤‡≤ï' },
          hi: { title: '‡§¶‡•ç‡§µ‡§æ‡§∞‡§™‡§æ‡§≤‡§ï‡§æ', desc: '‡§ú‡•à‡§∏‡•á ‡§π‡•Ä ‡§Ü‡§™ ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç, ‡§Ü‡§™ ‡§µ‡§ø‡§∂‡§æ‡§≤ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§™‡§æ‡§≤‡•ã‡§Ç ‡§ï‡•ã ‡§¶‡•á‡§ñ‡§§‡•á ‡§π‡•à‡§Ç, ‡§ú‡•ã ‡§™‡§µ‡§ø‡§§‡•ç‡§∞ ‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡•Ä ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§', nav: '‡§¶‡•ç‡§µ‡§æ‡§∞‡§™‡§æ‡§≤‡§ï‡§æ' }
        },
        lingam: {
          en: { title: 'Shiva Lingam', desc: 'This is the main deity, the Shiva Lingam. It stands as a symbol of cosmic power.', nav: 'Shiva Lingam' },
          ta: { title: '‡Æ≤‡Æø‡Æô‡Øç‡Æï‡ÆÆ‡Øç', desc: '‡Æá‡Æ§‡ØÅ ‡ÆÆ‡ØÅ‡Æï‡Øç‡Æï‡Æø‡ÆØ ‡Æ§‡ØÜ‡ÆØ‡Øç‡Æµ‡ÆÆ‡Øç, ‡Æö‡Æø‡Æµ‡Æ≤‡Æø‡Æô‡Øç‡Æï‡ÆÆ‡Øç. ‡Æá‡Æ§‡ØÅ ‡Æ™‡Æø‡Æ∞‡Æ™‡Æû‡Øç‡Æö ‡Æö‡Æï‡Øç‡Æ§‡Æø‡ÆØ‡Æø‡Æ©‡Øç ‡ÆÖ‡Æü‡Øà‡ÆØ‡Ææ‡Æ≥‡ÆÆ‡Ææ‡Æï‡Æ§‡Øç ‡Æ§‡Æø‡Æï‡Æ¥‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ.', nav: '‡Æ≤‡Æø‡Æô‡Øç‡Æï‡ÆÆ‡Øç' },
          kn: { title: '‡≤∂‡≤ø‡≤µ‡≤≤‡≤ø‡≤Ç‡≤ó', desc: '‡≤á‡≤¶‡≥Å ‡≤Æ‡≥Å‡≤ñ‡≥ç‡≤Ø ‡≤¶‡≥á‡≤µ‡≤§‡≥Ü, ‡≤∂‡≤ø‡≤µ‡≤≤‡≤ø‡≤Ç‡≤ó. ‡≤á‡≤¶‡≥Å ‡≤ï‡≤æ‡≤∏‡≥ç‡≤Æ‡≤ø‡≤ï‡≥ç ‡≤∂‡≤ï‡≥ç‡≤§‡≤ø‡≤Ø ‡≤∏‡≤Ç‡≤ï‡≥á‡≤§‡≤µ‡≤æ‡≤ó‡≤ø ‡≤®‡≤ø‡≤Ç‡≤§‡≤ø‡≤¶‡≥Ü.', nav: '‡≤∂‡≤ø‡≤µ‡≤≤‡≤ø‡≤Ç‡≤ó' },
          hi: { title: '‡§∂‡§ø‡§µ ‡§≤‡§ø‡§Ç‡§ó‡§Æ', desc: '‡§Ø‡§π ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§¶‡•á‡§µ‡§§‡§æ, ‡§∂‡§ø‡§µ ‡§≤‡§ø‡§Ç‡§ó‡§Æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ‡§æ‡§Ç‡§°‡•Ä‡§Ø ‡§∂‡§ï‡•ç‡§§‡§ø ‡§ï‡•á ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ñ‡§°‡§º‡§æ ‡§π‡•à‡•§', nav: '‡§∂‡§ø‡§µ ‡§≤‡§ø‡§Ç‡§ó‡§Æ' }
        }
      };

      Object.keys(translations).forEach(id => {
        const label = document.getElementById(`${id}-label`);
        if (label) {
          label.querySelector('.label-title').textContent = translations[id][lang].title;
          label.querySelector('.label-desc').textContent = translations[id][lang].desc;
        }
        const navBtn = document.getElementById(`btn-${id}`);
        if (navBtn) navBtn.textContent = translations[id][lang].nav;
      });

      // Update audio sources to audio/ folder
      document.querySelectorAll('audio').forEach(audio => {
        const baseId = audio.id.split('-')[0];
        const audioPath = baseId === 'nandi' ? 'nandhi' :
          baseId === 'dwarapalaka' ? 'dwarapalaka' :
            'shiva_lingam';
        audio.src = `audio/${audioPath}${lang === 'en' ? '' : '_' + lang}.mp3`;
        audio.load();
        console.log(`Loading audio: ${audio.src}`);
      });

      if (audioState === 'playing') playLocationAudio(currentActiveLocation);
    });

    function goTo(place) {
      if (!panoramaReady) {
        alert("Please wait while Street View loads...");
        return;
      }
      try {
        const svService = new google.maps.StreetViewService();
        const locations = {
          nandi: { lat: 10.782972, lng: 79.132250, heading: 270 },
          dwarapalaka: { lat: 10.782829, lng: 79.131980, heading: 273 },
          lingam: { lat: 10.782473, lng: 79.131742, heading: 272 }
        };

        const target = locations[place] || locations.nandi;

        svService.getPanorama({ location: target, radius: 50 }, (data, status) => {
          if (status === 'OK') {
            panorama.setPov({ heading: target.heading, pitch: 0, zoom: 1 });
            panorama.setPano(data.location.pano);
          }
        });
      } catch (e) {
        console.error(e);
      }
    }

    function initPanorama() {
      const sculptures = [
        { id: "nandi", location: { lat: 10.782972, lng: 79.132250 }, heading: 270, pitch: 0 },
        { id: "dwarapalaka", location: { lat: 10.782829, lng: 79.131980 }, heading: 273, pitch: 0 },
        { id: "lingam", location: { lat: 10.782473, lng: 79.131742 }, heading: 272, pitch: 0 }
      ];

      const visibleRange = 15;
      const distanceThreshold = 10;

      const svService = new google.maps.StreetViewService();
      svService.getPanorama({ location: sculptures[0].location, radius: 30 }, (data, status) => {
        if (status === "OK") {
          panorama = new google.maps.StreetViewPanorama(document.getElementById("street-view"), {
            pano: data.location.pano,
            pov: { heading: 250, pitch: 0 },
            visible: true,
            addressControl: false,
            linksControl: true,
            fullscreenControl: false
          });

          sculptures.forEach(sculpture => {
            sculpture.labelEl = document.getElementById(`${sculpture.id}-label`);
          });

          panorama.addListener("pov_changed", () => {
            const pov = panorama.getPov();
            const pos = panorama.getPosition();
            let newActiveLocation = null;

            sculptures.forEach(sculpture => {
              const headingDiff = Math.abs(pov.heading - sculpture.heading);
              const pitchDiff = Math.abs(pov.pitch - sculpture.pitch);
              const distance = google.maps.geometry.spherical.computeDistanceBetween(
                pos,
                new google.maps.LatLng(sculpture.location.lat, sculpture.location.lng)
              );

              const isVisible = headingDiff <= visibleRange && pitchDiff <= visibleRange && distance <= distanceThreshold;
              sculpture.labelEl.style.display = isVisible ? "block" : "none";
              if (isVisible) newActiveLocation = sculpture.id;
            });

            if (newActiveLocation && newActiveLocation !== currentActiveLocation) {
              currentActiveLocation = newActiveLocation;
              if (audioContextLoaded) playLocationAudio(newActiveLocation);
            }
          });
          panoramaReady = true;
        } else {
          console.error("Street View failed:", status);
          document.getElementById('street-view').innerHTML = `
            <div style="height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #fffaf5; color: #ff8c00; font-family: sans-serif; text-align: center; padding: 20px;">
              <h2 style="font-size: 2.5rem; margin-bottom: 20px;">Virtual View Unavailable</h2>
              <p style="font-size: 1.2rem; color: #666; max-width: 600px;">
                We're having trouble loading the Street View for this location.
              </p>
              <div style="margin-top:30px; padding:15px; background:white; border: 2px solid #ff8c00; border-radius:12px;">
                <strong>Error Status:</strong> ${status}
              </div>
            </div>`;
        }
      });
    }

    document.getElementById('fullscreen-btn').addEventListener('click', () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    });

    const checkReady = setInterval(() => {
      if (panoramaReady) {
        document.querySelectorAll('#location-buttons button').forEach(btn => btn.disabled = false);
        clearInterval(checkReady);
      }
    }, 500);
  </script>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=%GOOGLE_MAPS_API_KEY%&libraries=geometry&callback=initPanorama"
    async defer></script>
</body>

</html>