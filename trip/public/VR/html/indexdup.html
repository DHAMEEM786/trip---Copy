<!DOCTYPE html>
<html>

<head>
  <title>Brihadeeswarar Temple - Virtual Reality Tour</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Inter', sans-serif;
    }

    #street-view {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .top-settings-wrapper {
      position: absolute;
      top: 15px;
      right: 15px;
      z-index: 1002;
    }

    .settings-capsule {
      background: white;
      padding: 6px 10px;
      border-radius: 50px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
      display: flex;
      gap: 8px;
      align-items: center;
      border: 1px solid rgba(255, 140, 0, 0.1);
    }

    .settings-capsule select,
    .settings-capsule button {
      background: white;
      color: #ff8c00;
      border: none;
      padding: 8px 15px;
      border-radius: 40px;
      font-weight: bold;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s;
      outline: none;
    }

    #audio-control-btn {
      background: #ff8c00 !important;
      color: white !important;
      min-width: 140px;
    }

    #fullscreen-btn {
      background: #ff8c00 !important;
      color: white !important;
      border: 1px solid #ff8c00;
    }

    #fullscreen-btn:hover,
    #audio-control-btn:hover {
      opacity: 0.9;
      transform: scale(1.05);
    }

    #language-switcher:hover {
      background: #fff5e6;
    }

    .top-nav-wrapper {
      position: absolute;
      top: 15px;
      left: 15px;
      z-index: 1002;
      display: flex;
      gap: 10px;
      pointer-events: none;
    }

    #location-buttons {
      pointer-events: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    #location-buttons button {
      background: rgba(255, 255, 255, 0.95);
      color: #ff8c00;
      border: 2.5px solid #ff8c00;
      padding: 8px 16px;
      border-radius: 12px;
      font-weight: bold;
      cursor: pointer;
      white-space: nowrap;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transition: all 0.2s;
      font-size: 13px;
      min-width: 140px;
    }

    #location-buttons button:hover {
      background: #ff8c00;
      color: white;
      transform: scale(1.03);
      box-shadow: 0 6px 18px rgba(255, 140, 0, 0.3);
    }

    #vr-splash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      z-index: 10000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      transition: opacity 0.8s ease;
    }

    .splash-content h1 {
      color: #ff8c00;
      font-size: 2.5rem;
    }

    #start-vr-btn {
      padding: 15px 40px;
      background: #ff8c00;
      color: white;
      border: none;
      border-radius: 30px;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(255, 140, 0, 0.3);
    }

    .custom-label {
      position: absolute;
      background: white;
      color: #333;
      padding: 16px 24px;
      font-size: 18px;
      border-radius: 16px;
      transform: translate(-50%, -50%);
      top: 50%;
      left: 50%;
      z-index: 1001;
      display: none;
      pointer-events: none;
      border: 3px solid #ff8c00;
      box-shadow: 0 10px 30px rgba(255, 140, 0, 0.3);
      text-align: center;
      min-width: 250px;
      max-width: 400px;
    }

    .custom-label .label-title {
      color: #ff8c00;
      font-weight: 800;
      font-size: 22px;
      display: block;
      margin-bottom: 8px;
    }
  </style>
</head>

<body>
  <div id="vr-splash">
    <div class="splash-content">
      <h1>Experience Tanjore VR</h1>
      <p>Enter the immersive virtual tour of Brihadeeswarar Temple. Audio guide will start automatically.</p>
      <button id="start-vr-btn">Begin Virtual Tour</button>
    </div>
  </div>

  <div class="top-nav-wrapper">
    <div id="location-buttons">
      <button onclick="goTo('entrance')" id="btn-entrance">Entrance</button>
      <button onclick="goTo('courtyard')" id="btn-courtyard">First Courtyard</button>
      <button onclick="goTo('nandi')" id="btn-nandi">Nandi</button>
      <button onclick="goTo('dwarapalaka')" id="btn-dwarapalaka">Garbhagriha</button>
      <button onclick="goTo('lingam')" id="btn-lingam">Vimana</button>
    </div>
  </div>

  <div class="top-settings-wrapper">
    <div class="settings-capsule">
      <select id="language-switcher">
        <option value="en">English</option>
        <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
        <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
        <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
      </select>
      <button id="audio-control-btn">üîä Audio Enabled</button>
      <button id="fullscreen-btn">‚õ∂ Fullscreen</button>
    </div>
  </div>

  <div id="street-view"></div>
  <!-- Sculpture Labels -->
  <div class="custom-label" id="courtyard-label">
    <span class="label-title">First courtyard</span>
    <div class="label-desc">Welcome to the Brihadeeswarar Temple, or Thanjai Periya Kovil. Built over 1000 years ago by
      Raja Raja Chola I,
      this grand temple greets you with its elegant entrance tower.</div>
  </div>
  <div class="custom-label" id="entrance-label">
    <span class="label-title">ENTRANCE</span>
    <div class="label-desc">As you walk in, you enter a vast granite courtyard. Amazingly, there's no granite nearby ‚Äî
      imagine the planning
      it took to bring every stone here.</div>
  </div>
  <div class="custom-label" id="nandi-label">
    <span class="label-title">NANDHI SCULPTURE</span>
    <div class="label-desc">Ahead stands a giant statue of Nandi, Lord Shiva‚Äôs bull. Carved from a single stone and
      weighing 25 tons, Nandi
      gazes at the sanctum with timeless devotion.</div>
  </div>
  <div class="custom-label" id="dwarapalaka-label">
    <span class="label-title">Garbhagriha</span>
    <div class="label-desc">You‚Äôre in the heart of the temple ‚Äî the Garbhagriha. Here, a 13-foot tall Shiva Lingam glows
      softly under oil
      lamps. The silence, the chill ‚Äî it's pure spiritual energy.</div>
  </div>
  <div class="custom-label" id="lingam-label">
    <span class="label-title">VIMANA</span>
    <div class="label-desc">Look up! The Vimana rises over 66 meters high. Its top stone, the ‚ÄòKumbam‚Äô, weighs 80 tons ‚Äî
      placed there using
      just a ramp and elephants.</div>
  </div>

  <!-- Audio elements with preload -->
  <audio id="entrance-audio" src="audio/into t.mp3" preload="auto"></audio>
  <audio id="courtyard-audio" src="audio/first courtyard.mp3" preload="auto"></audio>
  <audio id="nandi-audio" src="audio/nandhi.mp3" preload="auto"></audio>
  <audio id="dwarapalaka-audio" src="audio/garbagarha.mp3" preload="auto"></audio>
  <audio id="lingam-audio" src="audio/vimana.mp3" preload="auto"></audio>




  <script>
    let panorama = null;
    let panoramaReady = false;
    let audioContextLoaded = false;
    let currentActiveLocation = null;
    const audioBtn = document.getElementById('audio-control-btn');

    // unified audio state: 'playing', 'paused', 'ended'
    let audioState = 'paused';

    function updateAudioButton() {
      if (audioState === 'playing') {
        audioBtn.textContent = 'üîä Audio Enabled';
        audioBtn.style.background = '#ff8c00';
        audioBtn.style.color = 'white';
      } else {
        audioBtn.textContent = 'üîá Audio Disabled';
        audioBtn.style.background = 'white';
        audioBtn.style.color = '#ff8c00';
      }
    }

    function toggleAudio() {
      if (audioState === 'playing') {
        window.speechSynthesis.cancel();
        document.querySelectorAll('audio').forEach(a => a.pause());
        audioState = 'paused';
      } else {
        playLocationAudio(currentActiveLocation);
      }
      updateAudioButton();
    }

    audioBtn.addEventListener('click', toggleAudio);

    function playLocationAudio(locationId) {
      window.speechSynthesis.cancel();
      document.querySelectorAll('audio').forEach(a => {
        a.pause();
        a.currentTime = 0;
      });

      const lang = document.getElementById('language-switcher').value;
      const audio = document.getElementById(`${locationId}-audio`);

      if (audio) {
        // Construct path based on language
        const baseId = locationId === 'nandi' ? 'nandhi' :
          locationId === 'entrance' ? 'into t' :
            locationId === 'courtyard' ? 'first courtyard' :
              locationId === 'dwarapalaka' ? 'garbagarha' : 'vimana';

        audio.src = `audio/${audioPath(locationId)}${lang === 'en' ? '' : '_' + lang}.mp3`;
        audio.load();

        audio.play().then(() => {
          audioState = 'playing';
          updateAudioButton();
        }).catch(err => {
          console.warn("Audio file missing, falling back to TTS:", err);
          speakDescription(locationId, lang);
        });
      } else {
        speakDescription(locationId, lang);
      }
    }

    function audioPath(id) {
      const map = {
        nandi: 'nandhi',
        entrance: 'into t',
        courtyard: 'first courtyard',
        dwarapalaka: 'garbagarha',
        lingam: 'vimana'
      };
      return map[id] || id;
    }

    function speakDescription(locationId, lang) {
      const translations = getTranslations();
      if (!translations[locationId] || !translations[locationId][lang]) return;

      window.speechSynthesis.cancel();
      const text = translations[locationId][lang].desc;
      const utterance = new SpeechSynthesisUtterance(text);

      const langMap = {
        en: ['en-IN', 'en-US'],
        ta: ['ta-IN'],
        kn: ['kn-IN'],
        hi: ['hi-IN']
      };

      const voices = window.speechSynthesis.getVoices();
      const targetLangs = langMap[lang] || ['en-US'];
      const selectedVoice = voices.find(v => targetLangs.some(l => v.lang.startsWith(l)));

      if (selectedVoice) utterance.voice = selectedVoice;
      utterance.lang = targetLangs[0];
      utterance.rate = 0.9;

      utterance.onstart = () => {
        audioState = 'playing';
        updateAudioButton();
      };
      utterance.onend = () => {
        audioState = 'paused';
        updateAudioButton();
      };

      window.speechSynthesis.speak(utterance);
    }

    function getTranslations() {
      return {
        nandi: {
          en: { title: 'NANDHI SCULPTURE', desc: 'Ahead stands a giant statue of Nandi, Lord Shiva‚Äôs bull. Carved from a single stone and weighing 25 tons, Nandi gazes at the sanctum with timeless devotion.', nav: 'Nandi' },
          ta: { title: '‡Æ®‡Æ®‡Øç‡Æ§‡Æø ‡Æö‡Æø‡Æ≤‡Øà', desc: '‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡Ææ‡Æ≤‡Øç ‡Æ®‡Æ®‡Øç‡Æ§‡Æø ‡Æö‡Æø‡Æ≤‡Øà‡ÆØ‡Æø‡Æ©‡Øç ‡Æ™‡Æø‡Æ∞‡ÆÆ‡Øç‡ÆÆ‡Ææ‡Æ£‡Øç‡Æü‡ÆÆ‡Ææ‡Æ© ‡Æö‡Æø‡Æ≤‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ, ‡Æá‡Æ§‡ØÅ ‡Æö‡Æø‡Æµ‡Æ™‡ØÜ‡Æ∞‡ØÅ‡ÆÆ‡Ææ‡Æ©‡Æø‡Æ©‡Øç ‡Æµ‡Ææ‡Æï‡Æ©‡ÆÆ‡Øç. ‡Æí‡Æ∞‡Øá ‡Æï‡Æ≤‡Øç‡Æ≤‡Æø‡Æ≤‡Øç ‡Æö‡ØÜ‡Æ§‡ØÅ‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡ØÅ 25 ‡Æü‡Æ©‡Øç ‡Æé‡Æü‡Øà‡ÆØ‡ØÅ‡Æ≥‡Øç‡Æ≥ ‡Æ®‡Æ®‡Øç‡Æ§‡Æø, ‡Æï‡Æ∞‡ØÅ‡Æµ‡Æ±‡Øà‡ÆØ‡Øà ‡Æ®‡Øã‡Æï‡Øç‡Æï‡ØÅ‡Æï‡Æø‡Æ±‡Ææ‡Æ∞‡Øç.', nav: '‡Æ®‡Æ®‡Øç‡Æ§‡Æø' },
          kn: { title: '‡≤®‡≤Ç‡≤¶‡≤ø ‡≤µ‡≤ø‡≤ó‡≥ç‡≤∞‡≤π', desc: '‡≤Æ‡≥Å‡≤Ç‡≤¶‡≥Ü ‡≤∂‡≤ø‡≤µ‡≤® ‡≤®‡≤Ç‡≤¶‡≤ø‡≤Ø ‡≤¨‡≥É‡≤π‡≤§‡≥ç ‡≤Æ‡≥Ç‡≤∞‡≥ç‡≤§‡≤ø ‡≤á‡≤¶‡≥Ü. ‡≤í‡≤Ç‡≤¶‡≥á ‡≤ï‡≤≤‡≥ç‡≤≤‡≤ø‡≤®‡≤ø‡≤Ç‡≤¶ ‡≤ï‡≥Ü‡≤§‡≥ç‡≤§‡≤≤‡≥ç‡≤™‡≤ü‡≥ç‡≤ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å 25 ‡≤ü‡≤®‡≥ç ‡≤§‡≥Ç‡≤ï‡≤¶ ‡≤®‡≤Ç‡≤¶‡≤ø‡≤Ø‡≥Å ‡≤∂‡≤æ‡≤∂‡≥ç‡≤µ‡≤§ ‡≤≠‡≤ï‡≥ç‡≤§‡≤ø‡≤Ø‡≤ø‡≤Ç‡≤¶ ‡≤ó‡≤∞‡≥ç‡≤≠‡≤ó‡≥Å‡≤°‡≤ø‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≥ã‡≤°‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü.', nav: '‡≤®‡≤Ç‡≤¶‡≤ø' },
          hi: { title: '‡§®‡§Ç‡§¶‡•Ä', desc: '‡§Ü‡§ó‡•á ‡§®‡§Ç‡§¶‡•Ä ‡§ï‡•Ä ‡§è‡§ï ‡§µ‡§ø‡§∂‡§æ‡§≤ ‡§Æ‡•Ç‡§∞‡•ç‡§§‡§ø ‡§ñ‡§°‡§º‡•Ä ‡§π‡•à, ‡§ú‡•ã ‡§≠‡§ó‡§µ‡§æ‡§® ‡§∂‡§ø‡§µ ‡§ï‡§æ ‡§¨‡•à‡§≤ ‡§π‡•à‡•§ ‡§è‡§ï ‡§π‡•Ä ‡§™‡§§‡•ç‡§•‡§∞ ‡§∏‡•á ‡§®‡§ï‡•ç‡§ï‡§æ‡§∂‡•Ä‡§¶‡§æ‡§∞ ‡§î‡§∞ 25 ‡§ü‡§® ‡§µ‡§ú‡§® ‡§ï‡§æ, ‡§®‡§Ç‡§¶‡•Ä ‡§∂‡§æ‡§∂‡•ç‡§µ‡§§ ‡§≠‡§ï‡•ç‡§§‡§ø ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ó‡§∞‡•ç‡§≠‡§ó‡•É‡§π ‡§ï‡•Ä ‡§ì‡§∞ ‡§¶‡•á‡§ñ‡§§‡§æ ‡§π‡•à‡•§', nav: '‡§®‡§Ç‡§¶‡•Ä' }
        },
        dwarapalaka: {
          en: { title: 'Garbhagriha', desc: 'You‚Äôre in the heart of the temple ‚Äî the Garbhagriha. Here, a 13-foot tall Shiva Lingam glows softly under oil lamps. The silence, the chill ‚Äî it\'s pure spiritual energy.', nav: 'Garbhagriha' },
          ta: { title: '‡Æï‡Æ∞‡ØÅ‡Æµ‡Æ±‡Øà', desc: '‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡Øã‡Æµ‡Æø‡Æ≤‡Æø‡Æ©‡Øç ‡ÆÆ‡Øà‡ÆØ‡Æ™‡Øç‡Æ™‡Æï‡ØÅ‡Æ§‡Æø‡ÆØ‡Æø‡Æ≤‡Øç ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç - ‡ÆÖ‡Æ§‡ØÅ‡Æ§‡Ææ‡Æ©‡Øç ‡Æï‡Æ∞‡ØÅ‡Æµ‡Æ±‡Øà. ‡Æá‡Æô‡Øç‡Æï‡Øá, 13 ‡ÆÖ‡Æü‡Æø ‡Æâ‡ÆØ‡Æ∞‡ÆÆ‡ØÅ‡Æ≥‡Øç‡Æ≥ ‡Æö‡Æø‡Æµ‡Æ≤‡Æø‡Æô‡Øç‡Æï‡ÆÆ‡Øç ‡ÆÖ‡Æï‡Æ≤‡Øç ‡Æµ‡Æø‡Æ≥‡Æï‡Øç‡Æï‡ØÅ‡Æï‡Æ≥‡Æø‡Æ©‡Øç ‡Æï‡ØÄ‡Æ¥‡Øç ‡ÆÆ‡ØÜ‡Æ©‡Øç‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æï ‡Æí‡Æ≥‡Æø‡Æ∞‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ.', nav: '‡Æï‡Æ∞‡ØÅ‡Æµ‡Æ±‡Øà' },
          kn: { title: '‡≤ó‡≤∞‡≥ç‡≤≠‡≤ó‡≥Å‡≤°‡≤ø', desc: '‡≤®‡≥Ä‡≤µ‡≥Å ‡≤¶‡≥á‡≤µ‡≤∏‡≥ç‡≤•‡≤æ‡≤®‡≤¶ ‡≤π‡≥É‡≤¶‡≤Ø‡≤≠‡≤æ‡≤ó‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø‡≤¶‡≥ç‡≤¶‡≥Ä‡≤∞‡≤ø - ‡≤ó‡≤∞‡≥ç‡≤≠‡≤ó‡≥Å‡≤°‡≤ø. ‡≤á‡≤≤‡≥ç‡≤≤‡≤ø, 13 ‡≤Ö‡≤°‡≤ø ‡≤é‡≤§‡≥ç‡≤§‡≤∞‡≤¶ ‡≤∂‡≤ø‡≤µ‡≤≤‡≤ø‡≤Ç‡≤ó‡≤µ‡≥Å ‡≤¶‡≥Ä‡≤™‡≤ó‡≤≥ ‡≤ï‡≥Ü‡≤≥‡≤ó‡≥Ü ‡≤Æ‡≥É‡≤¶‡≥Å‡≤µ‡≤æ‡≤ó‡≤ø ‡≤π‡≥ä‡≤≥‡≥Ü‡≤Ø‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü.', nav: '‡≤ó‡≤∞‡≥ç‡≤≠‡≤ó‡≥Å‡≤°‡≤ø' },
          hi: { title: '‡§ó‡§∞‡•ç‡§≠‡§ó‡•É‡§π', desc: '‡§Ü‡§™ ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§ï‡•á ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞ ‡§Æ‡•á‡§Ç ‡§π‡•à‡§Ç - ‡§ó‡§∞‡•ç‡§≠‡§ó‡•É‡§π‡•§ ‡§Ø‡§π‡§æ‡§Å, ‡§è‡§ï 13 ‡§´‡•Å‡§ü ‡§≤‡§Ç‡§¨‡§æ ‡§∂‡§ø‡§µ ‡§≤‡§ø‡§Ç‡§ó‡§Æ ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•á ‡§¶‡•Ä‡§™‡§ï‡•ã‡§Ç ‡§ï‡•á ‡§®‡•Ä‡§ö‡•á ‡§ß‡•Ä‡§∞‡•á ‡§∏‡•á ‡§ö‡§Æ‡§ï‡§§‡§æ ‡§π‡•à‡•§', nav: '‡§ó‡§∞‡•ç‡§≠‡§ó‡•É‡§π' }
        },
        lingam: {
          en: { title: 'Vimana', desc: 'Look up! The Vimana rises over 66 meters high. Its top stone, the ‚ÄòKumbam‚Äô, weighs 80 tons ‚Äî placed there using just a ramp and elephants.', nav: 'Vimana' },
          ta: { title: '‡Æµ‡Æø‡ÆÆ‡Ææ‡Æ©‡ÆÆ‡Øç', desc: '‡ÆÆ‡Øá‡Æ≤‡Øá ‡Æ™‡Ææ‡Æ∞‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç! ‡§µ‡§ø‡§Æ‡§æ‡§®‡ÆÆ‡Øç 66 ‡ÆÆ‡ØÄ‡Æü‡Øç‡Æü‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ§‡Æø‡Æï‡ÆÆ‡Ææ‡Æ© ‡Æâ‡ÆØ‡Æ∞‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡Æâ‡ÆØ‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ. ‡ÆÖ‡Æ§‡Æ©‡Øç ‡Æâ‡Æö‡Øç‡Æö‡Æø‡ÆØ‡Æø‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥ ‡Æï‡Æ≤‡Øç, 80 ‡Æü‡Æ©‡Øç ‡Æé‡Æü‡Øà‡ÆØ‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ.', nav: '‡Æµ‡Æø‡ÆÆ‡Ææ‡Æ©‡ÆÆ‡Øç' },
          kn: { title: '‡≤µ‡≤ø‡≤Æ‡≤æ‡≤®', desc: '‡≤Æ‡≥á‡≤≤‡≤ï‡≥ç‡≤ï‡≥Ü ‡≤®‡≥ã‡≤°‡≤ø! ‡≤µ‡≤ø‡≤Æ‡≤æ‡≤®‡≤µ‡≥Å 66 ‡≤Æ‡≥Ä‡≤ü‡≤∞‡≥ç‚Äå‡≤ó‡≤≥‡≤ø‡≤ó‡≤ø‡≤Ç‡≤§ ‡≤π‡≥Ü‡≤ö‡≥ç‡≤ö‡≥Å ‡≤é‡≤§‡≥ç‡≤§‡≤∞‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø‡≤¶‡≥Ü. ‡≤á‡≤¶‡≤∞ ‡≤Æ‡≥á‡≤≤‡≤ø‡≤® ‡≤ï‡≤≤‡≥ç‡≤≤‡≥Å 80 ‡≤ü‡≤®‡≥ç ‡≤§‡≥Ç‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü.', nav: '‡≤µ‡≤ø‡≤Æ‡≤æ‡≤®' },
          hi: { title: '‡§µ‡§ø‡§Æ‡§®‡§æ', desc: '‡§ä‡§™‡§∞ ‡§¶‡•á‡§ñ‡•á‡§Ç! ‡§µ‡§ø‡§Æ‡§æ‡§® 66 ‡§Æ‡•Ä‡§ü‡§∞ ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï ‡§ä‡§Å‡§ö‡§æ ‡§π‡•à‡•§ ‡§á‡§∏‡§ï‡•Ä ‡§ä‡§™‡§∞‡•Ä ‡§™‡§§‡•ç‡§•‡§∞ ‡§ï‡§æ ‡§µ‡§ú‡§® 80 ‡§ü‡§® ‡§π‡•à‡•§', nav: '‡§µ‡§ø‡§Æ‡§®‡§æ' }
        },
        entrance: {
          en: { title: 'Entrance', desc: 'As you walk in, you enter a vast granite courtyard. Amazingly, there\'s no granite nearby ‚Äî imagine the planning it took to bring every stone here.', nav: 'Entrance' },
          ta: { title: '‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡Ææ‡ÆØ‡Æø‡Æ≤‡Øç', desc: '‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡Øá ‡Æ®‡ØÅ‡Æ¥‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç‡Æ™‡Øã‡Æ§‡ØÅ, ‡Æí‡Æ∞‡ØÅ ‡Æ™‡Æø‡Æ∞‡ÆÆ‡Øç‡ÆÆ‡Ææ‡Æ£‡Øç‡Æü‡ÆÆ‡Ææ‡Æ© ‡Æï‡Æø‡Æ∞‡Ææ‡Æ©‡Øà‡Æü‡Øç ‡ÆÆ‡ØÅ‡Æ±‡Øç‡Æ±‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡ØÅ‡Æ≥‡Øç ‡Æ®‡ØÅ‡Æ¥‡Øà‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç. ‡ÆÜ‡Æö‡Øç‡Æö‡Æ∞‡Æø‡ÆØ‡ÆÆ‡Ææ‡Æï, ‡ÆÖ‡Æ∞‡ØÅ‡Æï‡Æø‡Æ≤‡Øç ‡Æé‡Æô‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æø‡Æ∞‡Ææ‡Æ©‡Øà‡Æü‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà.', nav: '‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡Ææ‡ÆØ‡Æø‡Æ≤‡Øç' },
          kn: { title: '‡≤™‡≥ç‡≤∞‡≤µ‡≥á‡≤∂ ‡≤¶‡≥ç‡≤µ‡≤æ‡≤∞', desc: '‡≤®‡≥Ä‡≤µ‡≥Å ‡≤í‡≤≥‡≤ó‡≥Ü ‡≤®‡≤°‡≥Ü‡≤¶‡≤Ç‡≤§‡≥Ü, ‡≤®‡≥Ä‡≤µ‡≥Å ‡≤µ‡≤ø‡≤∂‡≤æ‡≤≤‡≤µ‡≤æ‡≤¶ ‡≤ó‡≥ç‡≤∞‡≤æ‡≤®‡≥à‡≤ü‡≥ç ‡≤Ö‡≤Ç‡≤ó‡≤≥‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤™‡≥ç‡≤∞‡≤µ‡≥á‡≤∂‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≥Ä‡≤∞‡≤ø. ‡≤Ü‡≤∂‡≥ç‡≤ö‡≤∞‡≥ç‡≤Ø‡≤ï‡≤∞‡≤µ‡≤æ‡≤ó‡≤ø, ‡≤π‡≤§‡≥ç‡≤§‡≤ø‡≤∞‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤Ø‡≤æ‡≤µ‡≥Å‡≤¶‡≥á ‡≤ó‡≥ç‡≤∞‡≤æ‡≤®‡≥à‡≤ü‡≥ç ‡≤á‡≤≤‡≥ç‡≤≤.', nav: '‡≤™‡≥ç‡≤∞‡≤µ‡≥á‡≤∂ ‡≤¶‡≥ç‡≤µ‡≤æ‡≤∞' },
          hi: { title: '‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§¶‡•ç‡§µ‡§æ‡§∞', desc: '‡§ú‡•à‡§∏‡•á ‡§π‡•Ä ‡§Ü‡§™ ‡§Ö‡§Ç‡§¶‡§∞ ‡§ö‡§≤‡§§‡•á ‡§π‡•à‡§Ç, ‡§Ü‡§™ ‡§è‡§ï ‡§µ‡§ø‡§∂‡§æ‡§≤ ‡§ó‡•ç‡§∞‡•á‡§®‡§æ‡§á‡§ü ‡§Ü‡§Ç‡§ó‡§® ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§∂‡•ç‡§ö‡§∞‡•ç‡§Ø‡§ú‡§®‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á, ‡§™‡§æ‡§∏ ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§ó‡•ç‡§∞‡•á‡§®‡§æ‡§á‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§', nav: '‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§¶‡•ç‡§µ‡§æ‡§∞' }
        },
        courtyard: {
          en: { title: 'First Courtyard', desc: 'Welcome to the Brihadeeswarar Temple, or Thanjai Periya Kovil. Built over 1000 years ago by Raja Raja Chola I, this grand temple greets you with its elegant entrance tower.', nav: 'First Courtyard' },
          ta: { title: '‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Øç ‡ÆÆ‡ØÅ‡Æ±‡Øç‡Æ±‡ÆÆ‡Øç', desc: '‡Æ™‡Æø‡Æ∞‡Æï‡Æ§‡ØÄ‡Æ∏‡Øç‡Æµ‡Æ∞‡Æ∞‡Øç ‡Æï‡Øã‡Æµ‡Æø‡Æ≤‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æ§‡Æû‡Øç‡Æö‡Øà ‡Æ™‡ØÜ‡Æ∞‡Æø‡ÆØ ‡Æï‡Øã‡Æµ‡Æø‡Æ≤‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡Æµ‡Æ∞‡Æµ‡Øá‡Æ±‡Øç‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç. 1000 ‡ÆÜ‡Æ£‡Øç‡Æü‡ØÅ‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ™‡ØÅ ‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Ææ‡ÆÆ‡Øç ‡Æ∞‡Ææ‡Æú ‡Æ∞‡Ææ‡Æú ‡Æö‡Øã‡Æ¥‡Æ©‡Ææ‡Æ≤‡Øç ‡Æï‡Æü‡Øç‡Æü‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ.', nav: '‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Øç ‡ÆÆ‡ØÅ‡Æ±‡Øç‡Æ±‡ÆÆ‡Øç' },
          kn: { title: '‡≤Æ‡≥ä‡≤¶‡≤≤ ‡≤Ö‡≤Ç‡≤ó‡≤≥', desc: '‡≤¨‡≥É‡≤π‡≤¶‡≥Ä‡≤∂‡≥ç‡≤µ‡≤∞ ‡≤¶‡≥á‡≤µ‡≤∏‡≥ç‡≤•‡≤æ‡≤® ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤§‡≤Ç‡≤ú‡≥à ‡≤™‡≥Ü‡≤∞‡≤ø‡≤Ø‡≤æ ‡≤ï‡≥ã‡≤µ‡≤ø‡≤≤‡≥ç‚Äå‡≤ó‡≥Ü ‡≤∏‡≥Å‡≤∏‡≥ç‡≤µ‡≤æ‡≤ó‡≤§. 1000 ‡≤µ‡≤∞‡≥ç‡≤∑‡≤ó‡≤≥ ‡≤π‡≤ø‡≤Ç‡≤¶‡≥Ü ‡≤Æ‡≥ä‡≤¶‡≤≤ ‡≤∞‡≤æ‡≤ú ‡≤∞‡≤æ‡≤ú ‡≤ö‡≥ã‡≤≥‡≤®‡≤ø‡≤Ç‡≤¶ ‡≤®‡≤ø‡≤∞‡≥ç‡≤Æ‡≤ø‡≤∏‡≤≤‡≥ç‡≤™‡≤ü‡≥ç‡≤ü‡≤ø‡≤¶‡≥Ü.', nav: '‡≤Æ‡≥ä‡≤¶‡≤≤ ‡≤Ö‡≤Ç‡≤ó‡≤≥' },
          hi: { title: '‡§™‡•ç‡§∞‡§•‡§Æ ‡§Ü‡§Ç‡§ó‡§®', desc: '‡§¨‡•É‡§π‡§¶‡•á‡§∂‡•ç‡§µ‡§∞ ‡§Æ‡§Ç‡§¶‡§ø‡§∞, ‡§Ø‡§æ ‡§§‡§Ç‡§ú‡§à ‡§™‡•á‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã‡§µ‡§ø‡§≤ ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à‡•§ 1000 ‡§∏‡§æ‡§≤ ‡§™‡§π‡§≤‡•á ‡§∞‡§æ‡§ú‡§æ ‡§∞‡§æ‡§ú‡§æ ‡§ö‡•ã‡§≤ ‡§™‡•ç‡§∞‡§•‡§Æ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§ø‡§§‡•§', nav: '‡§™‡•ç‡§∞‡§•‡§Æ ‡§Ü‡§Ç‡§ó‡§®' }
        }
      };
    }

    // Handle Splash Screen and Start
    document.getElementById('start-vr-btn').addEventListener('click', () => {
      try {
        const splash = document.getElementById('vr-splash');
        if (splash) {
          splash.style.opacity = '0';
          setTimeout(() => {
            splash.style.display = 'none';
          }, 800);
        }

        currentActiveLocation = 'entrance';
        audioContextLoaded = true;

        // Use a short timeout to ensure UI updates before heavy lifting
        setTimeout(() => {
          playLocationAudio('entrance');
        }, 100);

      } catch (e) {
        console.error("Error starting VR:", e);
        // Force hide splash if error occurs
        document.getElementById('vr-splash').style.display = 'none';
      }
    });

    document.getElementById('language-switcher').addEventListener('change', function () {
      const lang = this.value;
      const trans = getTranslations();

      Object.keys(trans).forEach(id => {
        const label = document.getElementById(`${id}-label`);
        if (label) {
          label.querySelector('.label-title').textContent = trans[id][lang].title;
          label.querySelector('.label-desc').textContent = trans[id][lang].desc;
        }
        const navBtn = document.getElementById(`btn-${id}`);
        if (navBtn) navBtn.textContent = trans[id][lang].nav;
      });

      if (audioState === 'playing') playLocationAudio(currentActiveLocation);
    });

    function initPanorama() {
      const locations = [
        { id: 'entrance', location: { lat: 10.782800, lng: 79.134200 }, heading: 270 },
        { id: 'courtyard', location: { lat: 10.783170, lng: 79.132842 }, heading: 271 },
        { id: 'nandi', location: { lat: 10.782972, lng: 79.132250 }, heading: 274 },
        { id: 'dwarapalaka', location: { lat: 10.782829, lng: 79.131980 }, heading: 273 },
        { id: 'lingam', location: { lat: 10.782473, lng: 79.131742 }, heading: 272 }
      ];

      const svService = new google.maps.StreetViewService();
      // Initialize with Entrance - Increased radius to 100m
      svService.getPanorama({ location: locations[0].location, radius: 100 }, (data, status) => {
        if (status === 'OK') {
          panorama = new google.maps.StreetViewPanorama(document.getElementById('street-view'), {
            pano: data.location.pano,
            pov: { heading: locations[0].heading, pitch: 0 },
            visible: true,
            addressControl: false,
            linksControl: true,
            showRoadLabels: false,
            fullscreenControl: false // Custom button
          });

          panorama.addListener('pov_changed', () => {
            const pov = panorama.getPov();
            const pos = panorama.getPosition();
            let bestLoc = null;
            let minDistance = Infinity;

            locations.forEach(loc => {
              if (google.maps.geometry) {
                const distance = google.maps.geometry.spherical.computeDistanceBetween(
                  pos, new google.maps.LatLng(loc.location.lat, loc.location.lng)
                );

                const headingDiff = Math.abs((pov.heading % 360) - loc.heading);
                const isLookingAt = headingDiff <= 35 || (360 - headingDiff) <= 35;
                const isClose = distance <= 25;

                const label = document.getElementById(loc.id + '-label');
                if (label) {
                  label.style.display = (isClose && isLookingAt) ? 'block' : 'none';
                }

                if (distance < minDistance) {
                  minDistance = distance;
                  bestLoc = loc.id;
                }
              }
            });

            if (minDistance <= 25 && bestLoc && bestLoc !== currentActiveLocation) {
              currentActiveLocation = bestLoc;
              if (audioContextLoaded && audioState === 'playing') {
                playLocationAudio(bestLoc);
              }
            }
          });

          panoramaReady = true;
        } else {
          console.error("Street View data not found for init location");
        }
      });
    }

    function goTo(place) {
      const locations = {
        entrance: { lat: 10.782800, lng: 79.134200, heading: 270 },
        courtyard: { lat: 10.783170, lng: 79.132842, heading: 271 },
        nandi: { lat: 10.782972, lng: 79.132250, heading: 274 },
        dwarapalaka: { lat: 10.782829, lng: 79.131980, heading: 273 },
        lingam: { lat: 10.782473, lng: 79.131742, heading: 272 }
      };
      const target = locations[place];
      if (!panoramaReady) return;

      const svService = new google.maps.StreetViewService();
      // Increased radius to 100m here too
      svService.getPanorama({ location: target, radius: 100 }, (data, status) => {
        if (status === 'OK') {
          panorama.setPano(data.location.pano);
          panorama.setPov({ heading: target.heading, pitch: 0, zoom: 1 });
        }
      });
    }

    document.getElementById('fullscreen-btn').addEventListener('click', () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.log(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
        });
      } else {
        document.exitFullscreen();
      }
    });

    document.addEventListener('fullscreenchange', () => {
      const btn = document.getElementById('fullscreen-btn');
      if (document.fullscreenElement) {
        btn.innerHTML = '‚õ∂ Exit Fullscreen';
      } else {
        btn.innerHTML = '‚õ∂ Fullscreen';
      }
    });
  </script>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=%GOOGLE_MAPS_API_KEY%&libraries=geometry&callback=initPanorama"
    async defer></script>
</body>

</html>