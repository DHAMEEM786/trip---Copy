<!DOCTYPE html>
<html>

<head>
    <title>Gangai Konda Cholapuram - Virtual Reality Tour</title>
    <link rel="stylesheet" href="../html/indexdup.css">
    <style>
        #street-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .top-settings-wrapper {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 1002;
        }

        .settings-capsule {
            background: white;
            padding: 6px 10px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            display: flex;
            gap: 8px;
            align-items: center;
            border: 1px solid rgba(255, 140, 0, 0.1);
        }

        .settings-capsule select,
        .settings-capsule button {
            background: white;
            color: #ff8c00;
            border: none;
            padding: 8px 15px;
            border-radius: 40px;
            font-weight: bold;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
            outline: none;
        }

        #audio-control-btn {
            background: #ff8c00 !important;
            color: white !important;
            min-width: 140px;
        }

        #fullscreen-btn {
            background: #ff8c00 !important;
            color: white !important;
            border: 1px solid #ff8c00;
        }

        #fullscreen-btn:hover,
        #audio-control-btn:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }

        #language-switcher:hover {
            background: #fff5e6;
        }

        .top-nav-wrapper {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 1002;
            display: flex;
            gap: 10px;
            pointer-events: none;
        }

        #location-buttons {
            pointer-events: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        #location-buttons button {
            background: rgba(255, 255, 255, 0.95);
            color: #ff8c00;
            border: 2.5px solid #ff8c00;
            padding: 8px 16px;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            white-space: nowrap;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.2s;
            font-size: 13px;
            min-width: 180px;
        }

        #location-buttons button:hover {
            background: #ff8c00;
            color: white;
            transform: scale(1.03);
            box-shadow: 0 6px 18px rgba(255, 140, 0, 0.3);
        }

        .custom-label {
            z-index: 1001;
        }
    </style>
</head>

<body>
    <div id="vr-splash">
        <div class="splash-content">
            <h1>Experience Gangai Konda Cholapuram</h1>
            <p>Enter the immersive virtual tour of the Great Living Chola Temple. Audio guide will start automatically.
            </p>
            <button id="start-vr-btn">Begin Virtual Tour</button>
        </div>
    </div>

    <div class="top-nav-wrapper">
        <div id="location-buttons">
            <button onclick="goTo('entrance')" id="btn-entrance">Entrance & Nandhi</button>
            <button onclick="goTo('main_shrine')" id="btn-main_shrine">Kailashanadhar Temple</button>
            <button onclick="goTo('vimana_view')" id="btn-vimana_view">Main Vimana View</button>
            <button onclick="goTo('lion_well')" id="btn-lion_well">Lion Well (Simhakinaru)</button>
            <button onclick="goTo('mandapam')" id="btn-mandapam">Mahamandapam</button>
        </div>
    </div>

    <div class="top-settings-wrapper">
        <div class="settings-capsule">
            <select id="language-switcher">
                <option value="en">English</option>
                <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
                <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
            </select>
            <button id="audio-control-btn">üîä Audio Enabled</button>
            <button id="fullscreen-btn">‚õ∂ Fullscreen</button>
        </div>
    </div>

    <div id="street-view"></div>

    <!-- Labels -->
    <div class="custom-label" id="entrance-label">
        <span class="label-title">Entrance & Nandhi</span>
        <div class="label-desc">The grand entrance featuring the massive monolithic Nandi statue facing the shrine.
        </div>
    </div>
    <div class="custom-label" id="main_shrine-label">
        <span class="label-title">Kailashanadhar Temple</span>
        <div class="label-desc">The main sanctum sanctorum housing the colossal Shiva Lingam, similar to Thanjavur.
        </div>
    </div>
    <div class="custom-label" id="vimana_view-label">
        <span class="label-title">Main Vimana View</span>
        <div class="label-desc">A perfect view of the 55-meter high curvilinear Vimana, showing its unique concave
            structure.</div>
    </div>
    <div class="custom-label" id="lion_well-label">
        <span class="label-title">Lion Well (Simhakinaru)</span>
        <div class="label-desc">The famous lion-faced well entrance, said to be used by the King to pour heavy Ganges
            water.</div>
    </div>
    <div class="custom-label" id="mandapam-label">
        <span class="label-title">Mahamandapam</span>
        <div class="label-desc">The pillared hall with intricate Chola sculptures and artworks adorning the walls.</div>
    </div>

    <!-- Audio placeholders -->
    <audio id="entrance-audio" preload="auto"></audio>
    <audio id="main_shrine-audio" preload="auto"></audio>
    <audio id="vimana_view-audio" preload="auto"></audio>
    <audio id="lion_well-audio" preload="auto"></audio>
    <audio id="mandapam-audio" preload="auto"></audio>

    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyATew-TdTHzI9IZjizM8dOJxMBXPB6LRfE&libraries=geometry&callback=initPanorama"
        async defer></script>

    <script>
        let panorama = null;
        let panoramaReady = false;
        let audioContextLoaded = false;
        let currentActiveLocation = null;
        const audioBtn = document.getElementById('audio-control-btn');
        let audioState = 'paused';

        const translations = {
            entrance: {
                en: { title: 'Entrance & Nandhi', desc: 'The grand entrance featuring the massive monolithic Nandi statue facing the shrine.', nav: 'Entrance & Nandhi' },
                ta: { title: '‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡Ææ‡ÆØ‡Æø‡Æ≤‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ®‡Æ®‡Øç‡Æ§‡Æø', desc: '‡Æö‡Æ©‡Øç‡Æ©‡Æ§‡Æø‡ÆØ‡Øà ‡Æé‡Æ§‡Æø‡Æ∞‡Øç‡Æï‡Øä‡Æ≥‡Øç‡Æ≥‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Æø‡Æ∞‡ÆÆ‡Ææ‡Æ£‡Øç‡Æü‡ÆÆ‡Ææ‡Æ© ‡Æí‡Æ±‡Øç‡Æ±‡Øà‡Æï‡Øç‡Æï‡Æ≤‡Øç ‡Æ®‡Æ®‡Øç‡Æ§‡Æø ‡Æö‡Æø‡Æ≤‡Øà‡ÆØ‡ØÅ‡Æü‡Æ©‡Øç ‡Æï‡ØÇ‡Æü‡Æø‡ÆØ ‡Æ™‡Æø‡Æ∞‡Æ§‡Ææ‡Æ© ‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡Ææ‡ÆØ‡Æø‡Æ≤‡Øç.', nav: '‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡Ææ‡ÆØ‡Æø‡Æ≤‡Øç & ‡Æ®‡Æ®‡Øç‡Æ§‡Æø' },
                kn: { title: '‡≤™‡≥ç‡≤∞‡≤µ‡≥á‡≤∂‡≤¶‡≥ç‡≤µ‡≤æ‡≤∞ ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤®‡≤Ç‡≤¶‡≤ø', desc: '‡≤ó‡≤∞‡≥ç‡≤≠‡≤ó‡≥Å‡≤°‡≤ø ‡≤é‡≤¶‡≥Å‡≤∞‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤∞‡≥Å‡≤µ ‡≤¨‡≥É‡≤π‡≤§‡≥ç ‡≤è‡≤ï‡≤∂‡≤ø‡≤≤‡≤æ ‡≤®‡≤Ç‡≤¶‡≤ø ‡≤µ‡≤ø‡≤ó‡≥ç‡≤∞‡≤π‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤í‡≤≥‡≤ó‡≥ä‡≤Ç‡≤°‡≤ø‡≤∞‡≥Å‡≤µ ‡≤≠‡≤µ‡≥ç‡≤Ø ‡≤™‡≥ç‡≤∞‡≤µ‡≥á‡≤∂‡≤¶‡≥ç‡≤µ‡≤æ‡≤∞.', nav: '‡≤™‡≥ç‡≤∞‡≤µ‡≥á‡≤∂‡≤¶‡≥ç‡≤µ‡≤æ‡≤∞ & ‡≤®‡≤Ç‡≤¶‡≤ø' },
                hi: { title: '‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§î‡§∞ ‡§®‡§Ç‡§¶‡•Ä', desc: '‡§ó‡§∞‡•ç‡§≠‡§ó‡•É‡§π ‡§ï‡•á ‡§∏‡§æ‡§Æ‡§®‡•á ‡§µ‡§ø‡§∂‡§æ‡§≤ ‡§Ö‡§ñ‡§Ç‡§° ‡§®‡§Ç‡§¶‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§Æ‡§æ ‡§µ‡§æ‡§≤‡§æ ‡§≠‡§µ‡•ç‡§Ø ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§¶‡•ç‡§µ‡§æ‡§∞‡•§', nav: '‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§î‡§∞ ‡§®‡§Ç‡§¶‡•Ä' }
            },
            main_shrine: {
                en: { title: 'Kailashanadhar Temple', desc: 'The main sanctum sanctorum housing the colossal Shiva Lingam, similar to Thanjavur.', nav: 'Kailashanadhar Temple' },
                ta: { title: '‡Æï‡Øà‡Æ≤‡Ææ‡Æö‡Æ®‡Ææ‡Æ§‡Æ∞‡Øç ‡Æï‡Øã‡Æµ‡Æø‡Æ≤‡Øç', desc: '‡Æ§‡Æû‡Øç‡Æö‡Ææ‡Æµ‡ØÇ‡Æ∞‡Øà‡Æ™‡Øç ‡Æ™‡Øã‡Æ≤‡Æµ‡Øá ‡ÆÆ‡Æø‡Æï‡Æ™‡Øç‡Æ™‡ØÜ‡Æ∞‡Æø‡ÆØ ‡Æö‡Æø‡Æµ‡Æ≤‡Æø‡Æô‡Øç‡Æï‡ÆÆ‡Øç ‡ÆÖ‡ÆÆ‡Øà‡Æ®‡Øç‡Æ§‡ØÅ‡Æ≥‡Øç‡Æ≥ ‡Æ™‡Æø‡Æ∞‡Æ§‡Ææ‡Æ© ‡Æï‡Æ∞‡ØÅ‡Æµ‡Æ±‡Øà.', nav: '‡Æï‡Øà‡Æ≤‡Ææ‡Æö‡Æ®‡Ææ‡Æ§‡Æ∞‡Øç ‡Æï‡Øã‡Æµ‡Æø‡Æ≤‡Øç' },
                kn: { title: '‡≤ï‡≥à‡≤≤‡≤æ‡≤∂‡≤®‡≤æ‡≤•‡≤∞‡≥ç ‡≤¶‡≥á‡≤µ‡≤∏‡≥ç‡≤•‡≤æ‡≤®', desc: '‡≤§‡≤Ç‡≤ú‡≤æ‡≤µ‡≥Ç‡≤∞‡≤ø‡≤®‡≤Ç‡≤§‡≥Ü‡≤Ø‡≥á ‡≤¨‡≥É‡≤π‡≤§‡≥ç ‡≤∂‡≤ø‡≤µ‡≤≤‡≤ø‡≤Ç‡≤ó‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤π‡≥ä‡≤Ç‡≤¶‡≤ø‡≤∞‡≥Å‡≤µ ‡≤Æ‡≥Å‡≤ñ‡≥ç‡≤Ø ‡≤ó‡≤∞‡≥ç‡≤≠‡≤ó‡≥Å‡≤°‡≤ø.', nav: '‡≤ï‡≥à‡≤≤‡≤æ‡≤∂‡≤®‡≤æ‡≤•‡≤∞‡≥ç ‡≤¶‡≥á‡≤µ‡≤∏‡≥ç‡≤•‡≤æ‡≤®' },
                hi: { title: '‡§ï‡•à‡§≤‡§æ‡§∂‡§®‡§æ‡§¶‡§∞ ‡§Æ‡§Ç‡§¶‡§ø‡§∞', desc: '‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ó‡§∞‡•ç‡§≠‡§ó‡•É‡§π ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§§‡§Ç‡§ú‡§æ‡§µ‡•Å‡§∞ ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§® ‡§µ‡§ø‡§∂‡§æ‡§≤ ‡§∂‡§ø‡§µ ‡§≤‡§ø‡§Ç‡§ó ‡§π‡•à‡•§', nav: '‡§ï‡•à‡§≤‡§æ‡§∂‡§®‡§æ‡§¶‡§∞ ‡§Æ‡§Ç‡§¶‡§ø‡§∞' }
            },
            vimana_view: {
                en: { title: 'Main Vimana View', desc: 'A perfect view of the 55-meter high curvilinear Vimana, showing its unique concave structure.', nav: 'Main Vimana View' },
                ta: { title: '‡ÆÆ‡ØÅ‡Æï‡Øç‡Æï‡Æø‡ÆØ ‡Æµ‡Æø‡ÆÆ‡Ææ‡Æ©‡Æï‡Øç ‡Æï‡Ææ‡Æü‡Øç‡Æö‡Æø', desc: '55 ‡ÆÆ‡ØÄ‡Æü‡Øç‡Æü‡Æ∞‡Øç ‡Æâ‡ÆØ‡Æ∞‡ÆÆ‡ØÅ‡Æ≥‡Øç‡Æ≥ ‡Æµ‡Æ≥‡Øà‡Æ®‡Øç‡Æ§ ‡Æµ‡Æø‡ÆÆ‡Ææ‡Æ©‡Æ§‡Øç‡Æ§‡Æø‡Æ©‡Øç ‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ© ‡Æï‡Ææ‡Æü‡Øç‡Æö‡Æø, ‡ÆÖ‡Æ§‡Æ©‡Øç ‡Æ§‡Æ©‡Æø‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ‡ÆÆ‡Ææ‡Æ© ‡Æï‡ØÅ‡Æ¥‡Æø‡Æµ‡Ææ‡Æ© ‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡Øà‡Æï‡Øç ‡Æï‡Ææ‡Æü‡Øç‡Æü‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ.', nav: '‡Æµ‡Æø‡ÆÆ‡Ææ‡Æ©‡Æï‡Øç ‡Æï‡Ææ‡Æü‡Øç‡Æö‡Æø' },
                kn: { title: '‡≤Æ‡≥Å‡≤ñ‡≥ç‡≤Ø ‡≤µ‡≤ø‡≤Æ‡≤æ‡≤®‡≤¶ ‡≤®‡≥ã‡≤ü', desc: '55 ‡≤Æ‡≥Ä‡≤ü‡≤∞‡≥ç ‡≤é‡≤§‡≥ç‡≤§‡≤∞‡≤¶ ‡≤µ‡≤ï‡≥ç‡≤∞‡≤∞‡≥á‡≤ñ‡≥Ü‡≤Ø ‡≤µ‡≤ø‡≤Æ‡≤æ‡≤®‡≤¶ ‡≤™‡≤∞‡≤ø‡≤™‡≥Ç‡≤∞‡≥ç‡≤£ ‡≤®‡≥ã‡≤ü, ‡≤Ö‡≤¶‡≤∞ ‡≤µ‡≤ø‡≤∂‡≤ø‡≤∑‡≥ç‡≤ü ‡≤®‡≤ø‡≤Æ‡≥ç‡≤® ‡≤∞‡≤ö‡≤®‡≥Ü‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≥ã‡≤∞‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü.', nav: '‡≤µ‡≤ø‡≤Æ‡≤æ‡≤®‡≤¶ ‡≤®‡≥ã‡≤ü' },
                hi: { title: '‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§µ‡§ø‡§Æ‡§æ‡§® ‡§¶‡•É‡§∂‡•ç‡§Ø', desc: '55 ‡§Æ‡•Ä‡§ü‡§∞ ‡§ä‡§Ç‡§ö‡•á ‡§µ‡§ï‡•ç‡§∞ ‡§µ‡§ø‡§Æ‡§æ‡§® ‡§ï‡§æ ‡§è‡§ï ‡§Ü‡§¶‡§∞‡•ç‡§∂ ‡§¶‡•É‡§∂‡•ç‡§Ø, ‡§ú‡•ã ‡§á‡§∏‡§ï‡•Ä ‡§Ö‡§®‡•Ç‡§†‡•Ä ‡§Ö‡§µ‡§§‡§≤ ‡§∏‡§Ç‡§∞‡§ö‡§®‡§æ ‡§ï‡•ã ‡§¶‡§∞‡•ç‡§∂‡§æ‡§§‡§æ ‡§π‡•à‡•§', nav: '‡§µ‡§ø‡§Æ‡§æ‡§® ‡§¶‡•É‡§∂‡•ç‡§Ø' }
            },
            lion_well: {
                en: { title: 'Lion Well (Simhakinaru)', desc: 'The famous lion-faced well entrance, said to be used by the King to pour heavy Ganges water.', nav: 'Lion Well' },
                ta: { title: '‡Æö‡Æø‡ÆÆ‡Øç‡ÆÆ ‡Æï‡Æø‡Æ£‡Æ±‡ØÅ', desc: '‡Æ™‡ØÅ‡Æï‡Æ¥‡Øç‡Æ™‡ØÜ‡Æ±‡Øç‡Æ± ‡Æö‡Æø‡Æô‡Øç‡Æï ‡ÆÆ‡ØÅ‡Æï‡ÆÆ‡Øç ‡Æï‡Øä‡Æ£‡Øç‡Æü ‡Æï‡Æø‡Æ£‡Æ±‡ØÅ ‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡Ææ‡ÆØ‡Æø‡Æ≤‡Øç, ‡Æï‡Æô‡Øç‡Æï‡Øà ‡Æ®‡ØÄ‡Æ∞‡Øà ‡Æä‡Æ±‡Øç‡Æ± ‡ÆÆ‡Æ©‡Øç‡Æ©‡Æ∞‡Ææ‡Æ≤‡Øç ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡Ææ‡Æï ‡Æï‡ØÇ‡Æ±‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ.', nav: '‡Æö‡Æø‡ÆÆ‡Øç‡ÆÆ ‡Æï‡Æø‡Æ£‡Æ±‡ØÅ' },
                kn: { title: '‡≤∏‡≤ø‡≤Ç‡≤π ‡≤¨‡≤æ‡≤µ‡≤ø (‡≤∏‡≤ø‡≤Ç‡≤π‡≤ï‡≤ø‡≤®‡≤æ‡≤∞‡≥Å)', desc: '‡≤™‡≥ç‡≤∞‡≤∏‡≤ø‡≤¶‡≥ç‡≤ß ‡≤∏‡≤ø‡≤Ç‡≤π‡≤¶ ‡≤Æ‡≥Å‡≤ñ‡≤¶ ‡≤¨‡≤æ‡≤µ‡≤ø ‡≤™‡≥ç‡≤∞‡≤µ‡≥á‡≤∂‡≤¶‡≥ç‡≤µ‡≤æ‡≤∞, ‡≤∞‡≤æ‡≤ú‡≤®‡≥Å ‡≤ó‡≤Ç‡≤ó‡≤æ ‡≤®‡≥Ä‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≥Å‡≤∞‡≤ø‡≤Ø‡≤≤‡≥Å ‡≤¨‡≤≥‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥ç‡≤¶‡≤®‡≥Ü‡≤Ç‡≤¶‡≥Å ‡≤π‡≥á‡≤≥‡≤≤‡≤æ‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü.', nav: '‡≤∏‡≤ø‡≤Ç‡≤π ‡≤¨‡≤æ‡≤µ‡≤ø' },
                hi: { title: '‡§∏‡§ø‡§Æ‡•ç‡§π‡§ï‡§ø‡§®‡§æ‡§∞‡•Å (‡§∂‡•á‡§∞ ‡§ï‡•Å‡§Ü‡§Ç)', desc: '‡§™‡•ç‡§∞‡§∏‡§ø‡§¶‡•ç‡§ß ‡§∂‡•á‡§∞‡§Æ‡•Å‡§ñ ‡§ï‡•Å‡§Ü‡§Ç ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§¶‡•ç‡§µ‡§æ‡§∞, ‡§ï‡§π‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§∞‡§æ‡§ú‡§æ ‡§á‡§∏‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ó‡§Ç‡§ó‡§æ ‡§ï‡§æ ‡§™‡§æ‡§®‡•Ä ‡§°‡§æ‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§∞‡§§‡•á ‡§•‡•á‡•§', nav: '‡§∂‡•á‡§∞ ‡§ï‡•Å‡§Ü‡§Ç' }
            },
            mandapam: {
                en: { title: 'Mahamandapam', desc: 'The pillared hall with intricate Chola sculptures and artworks adorning the walls.', nav: 'Mahamandapam' },
                ta: { title: '‡ÆÆ‡Æï‡Ææ ‡ÆÆ‡Æ£‡Øç‡Æü‡Æ™‡ÆÆ‡Øç', desc: '‡Æö‡ØÅ‡Æµ‡Æ∞‡Øç‡Æï‡Æ≥‡Æø‡Æ≤‡Øç ‡Æö‡Æø‡Æï‡Øç‡Æï‡Æ≤‡Ææ‡Æ© ‡Æö‡Øã‡Æ¥‡Æ∞‡Øç ‡Æö‡Æø‡Æ±‡Øç‡Æ™‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æ≤‡Øà‡Æ™‡Øç‡Æ™‡Æü‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡ØÅ‡Æü‡Æ©‡Øç ‡Æï‡ØÇ‡Æü‡Æø‡ÆØ ‡Æ§‡ØÇ‡Æ£‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡Øä‡Æ£‡Øç‡Æü ‡ÆÆ‡Æ£‡Øç‡Æü‡Æ™‡ÆÆ‡Øç.', nav: '‡ÆÆ‡Æï‡Ææ ‡ÆÆ‡Æ£‡Øç‡Æü‡Æ™‡ÆÆ‡Øç' },
                kn: { title: '‡≤Æ‡≤π‡≤æ‡≤Æ‡≤Ç‡≤ü‡≤™', desc: '‡≤ó‡≥ã‡≤°‡≥Ü‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤Ö‡≤≤‡≤Ç‡≤ï‡≤∞‡≤ø‡≤∏‡≥Å‡≤µ ‡≤∏‡≤Ç‡≤ï‡≥Ä‡≤∞‡≥ç‡≤£‡≤µ‡≤æ‡≤¶ ‡≤ö‡≥ã‡≤≥ ‡≤∂‡≤ø‡≤≤‡≥ç‡≤™‡≤ó‡≤≥‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤ï‡≤≤‡≤æ‡≤ï‡≥É‡≤§‡≤ø‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤π‡≥ä‡≤Ç‡≤¶‡≤ø‡≤∞‡≥Å‡≤µ ‡≤ï‡≤Ç‡≤¨‡≤¶ ‡≤Æ‡≤Ç‡≤ü‡≤™.', nav: '‡≤Æ‡≤π‡≤æ‡≤Æ‡≤Ç‡≤ü‡≤™' },
                hi: { title: '‡§Æ‡§π‡§æ‡§Æ‡§Ç‡§°‡§™', desc: '‡§¶‡•Ä‡§µ‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡•Å‡§∂‡•ã‡§≠‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§ú‡§ü‡§ø‡§≤ ‡§ö‡•ã‡§≤ ‡§Æ‡•Ç‡§∞‡•ç‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§î‡§∞ ‡§ï‡§≤‡§æ‡§ï‡•É‡§§‡§ø ‡§µ‡§æ‡§≤‡§æ ‡§∏‡•ç‡§§‡§Ç‡§≠ ‡§π‡•â‡§≤‡•§', nav: '‡§Æ‡§π‡§æ‡§Æ‡§Ç‡§°‡§™' }
            }
        };

        function updateAudioButton() {
            if (audioState === 'playing') {
                audioBtn.textContent = 'üîä Audio Enabled';
                audioBtn.style.background = '#ff8c00';
            } else {
                audioBtn.textContent = 'üîá Audio Disabled';
                audioBtn.style.background = 'white';
                audioBtn.style.color = '#ff8c00';
            }
        }

        function playLocationAudio(locationId) {
            // Stop any current audio or speech
            window.speechSynthesis.cancel();
            document.querySelectorAll('audio').forEach(a => {
                a.pause();
                a.currentTime = 0;
            });

            const lang = document.getElementById('language-switcher').value;
            const audio = document.getElementById(`${locationId}-audio`);

            if (audio) {
                // Try to play file: audio/entrance_en.mp3
                const filename = `audio/${locationId}_${lang}.mp3`;
                audio.src = filename;

                // We attempt to load and play
                const playPromise = audio.play();

                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        console.log(`Playing audio file: ${filename}`);
                        audioState = 'playing';
                        updateAudioButton();

                        audio.onended = () => {
                            audioState = 'paused';
                            updateAudioButton();
                        };
                    }).catch(error => {
                        console.warn(`File ${filename} not found or blocked. Falling back to TTS.`);
                        speakDescription(locationId, lang);
                    });
                }
            } else {
                speakDescription(locationId, lang);
            }
        }

        function playOnlineTTS(text, lang) {
            console.log(`Attempting Online TTS for ${lang}...`);
            // Using a CORS proxy or direct call if allowed (often works for simple GETs from browser)
            const url = `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&tl=${lang}&q=${encodeURIComponent(text)}`;
            const audio = new Audio(url);

            audio.play().then(() => {
                audioState = 'playing';
                updateAudioButton();
                audio.onended = () => {
                    audioState = 'paused';
                    updateAudioButton();
                };
            }).catch(e => {
                console.warn('Online TTS failed', e);
                // Last resort: force browser to try its best
                speakDescription(currentActiveLocation, lang, true);
            });
        }

        function speakDescription(locationId, lang, forceBrowser = false) {
            if (!translations[locationId]) return;

            // If it's Tamil or Kannada, and we aren't forcing browser, try online TTS first
            // because Windows often lacks these voices by default.
            if (!forceBrowser && (lang === 'ta' || lang === 'kn')) {
                const text = translations[locationId][lang].desc;
                playOnlineTTS(text, lang);
                return;
            }

            window.speechSynthesis.cancel();

            const text = translations[locationId][lang].desc;
            const utterance = new SpeechSynthesisUtterance(text);

            let voices = window.speechSynthesis.getVoices();

            if (voices.length === 0 && !forceBrowser) {
                setTimeout(() => speakDescription(locationId, lang, forceBrowser), 100);
                return;
            }

            const langMap = {
                en: 'en',
                ta: 'ta',
                kn: 'kn',
                hi: 'hi'
            };

            const targetLangShort = langMap[lang] || 'en';
            let selectedVoice = voices.find(v => v.lang.toLowerCase().includes(targetLangShort));

            const googleVoice = voices.find(v => v.lang.toLowerCase().includes(targetLangShort) && v.name.includes('Google'));
            if (googleVoice) selectedVoice = googleVoice;

            if (selectedVoice) {
                console.log(`Using voice for ${lang}: ${selectedVoice.name}`);
                utterance.voice = selectedVoice;
                utterance.lang = selectedVoice.lang;
            } else {
                console.warn(`No specific voice found for ${lang}. Trying fallback.`);
                utterance.lang = targetLangShort === 'en' ? 'en-US' : (targetLangShort + '-IN');
            }

            utterance.rate = 0.9;
            utterance.pitch = 1.0;

            utterance.onstart = () => {
                audioState = 'playing';
                updateAudioButton();
            };

            utterance.onend = () => {
                audioState = 'paused';
                updateAudioButton();
            };

            window.speechSynthesis.speak(utterance);
        }

        function toggleAudio() {
            if (audioState === 'playing') {
                window.speechSynthesis.cancel();
                document.querySelectorAll('audio').forEach(a => a.pause());
                audioState = 'paused';
            } else {
                playLocationAudio(currentActiveLocation);
            }
            updateAudioButton();
        }

        audioBtn.addEventListener('click', toggleAudio);

        document.getElementById('start-vr-btn').addEventListener('click', () => {
            document.getElementById('vr-splash').style.display = 'none';
            currentActiveLocation = 'entrance';
            audioContextLoaded = true;
            playLocationAudio('entrance');
        });

        document.getElementById('language-switcher').addEventListener('change', function () {
            const lang = this.value;
            Object.keys(translations).forEach(id => {
                const label = document.getElementById(`${id}-label`);
                if (label) {
                    label.querySelector('.label-title').textContent = translations[id][lang].title;
                    label.querySelector('.label-desc').textContent = translations[id][lang].desc;
                }
                const navBtn = document.getElementById(`btn-${id}`);
                if (navBtn) navBtn.textContent = translations[id][lang].nav;
            });
            if (audioState === 'playing') playLocationAudio(currentActiveLocation);
        });

        function goTo(place) {
            const locations = {
                entrance: { lat: 11.2063126, lng: 79.4497293, heading: 271.15 },
                main_shrine: { lat: 11.2065967, lng: 79.448591, heading: 0 },
                vimana_view: { lat: 11.2063765, lng: 79.4480341, heading: 0 },
                lion_well: { lat: 11.206582, lng: 79.4491841, heading: 0 },
                mandapam: { lat: 11.2066977, lng: 79.4488482, heading: 0 }
            };
            const target = locations[place];
            const svService = new google.maps.StreetViewService();
            svService.getPanorama({ location: target, radius: 50 }, (data, status) => {
                if (status === 'OK') {
                    panorama.setPano(data.location.pano);
                    panorama.setPov({ heading: target.heading, pitch: 0, zoom: 1 });
                    currentActiveLocation = place;
                }
            });
        }

        function initPanorama() {
            const spots = [
                { id: "entrance", location: { lat: 11.2063126, lng: 79.4497293 }, heading: 271.15 },
                { id: "main_shrine", location: { lat: 11.2065967, lng: 79.448591 }, heading: 0 },
                { id: "vimana_view", location: { lat: 11.2063765, lng: 79.4480341 }, heading: 0 },
                { id: "lion_well", location: { lat: 11.206582, lng: 79.4491841 }, heading: 0 },
                { id: "mandapam", location: { lat: 11.2066977, lng: 79.4488482 }, heading: 0 }
            ];

            const svService = new google.maps.StreetViewService();
            // Increased radius to 200m to be safer
            svService.getPanorama({ location: spots[0].location, radius: 200 }, (data, status) => {
                if (status === "OK") {
                    panorama = new google.maps.StreetViewPanorama(document.getElementById("street-view"), {
                        pano: data.location.pano,
                        pov: { heading: spots[0].heading, pitch: 0 },
                        visible: true,
                        addressControl: false,
                        fullscreenControl: false // Custom button used
                    });

                    panorama.addListener("pov_changed", () => {
                        const pov = panorama.getPov();
                        const pos = panorama.getPosition();
                        if (!pos) return;
                        let newActiveLocation = null;

                        spots.forEach(spot => {
                            let headingDiff = Math.abs((pov.heading % 360 + 360) % 360 - spot.heading);
                            if (headingDiff > 180) headingDiff = 360 - headingDiff;

                            const distance = google.maps.geometry.spherical.computeDistanceBetween(
                                pos, new google.maps.LatLng(spot.location.lat, spot.location.lng)
                            );

                            const isVisible = distance <= 40 && headingDiff <= 45;
                            document.getElementById(`${spot.id}-label`).style.display = isVisible ? "block" : "none";
                            if (isVisible) newActiveLocation = spot.id;
                        });

                        if (newActiveLocation && newActiveLocation !== currentActiveLocation) {
                            currentActiveLocation = newActiveLocation;
                            if (audioState === 'playing') {
                                playLocationAudio(newActiveLocation);
                            }
                        }
                    });
                    panoramaReady = true;
                } else {
                    console.error("Street View data not found for init location. Status:", status);
                    alert("Street View data not found for this location. Please check your internet connection or API key.");
                }
            });
        }

        // Fullscreen Logic
        document.getElementById('fullscreen-btn').addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                });
            } else {
                document.exitFullscreen();
            }
        });

        // Also handle escape key to update button text if needed (optional)
        document.addEventListener('fullscreenchange', () => {
            const btn = document.getElementById('fullscreen-btn');
            if (document.fullscreenElement) {
                btn.innerHTML = '‚õ∂ Exit Fullscreen';
            } else {
                btn.innerHTML = '‚õ∂ Fullscreen';
            }
        });
    </script>
</body>

</html>